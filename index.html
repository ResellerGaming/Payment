<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pembayaran Online — Black & Gold</title>

  <!-- EmailJS & jsPDF -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0b0b;
      --bg-soft:#121212;
      --panel:#171717;
      --panel-2:#1d1d1d;
      --text:#eaeaea;
      --muted:#b8b8b8;
      --gold:#d4af37;
      --gold-2:#f0d98a;
      --danger:#ff5a5a;
      --ok:#33d69f;
      --radius:18px;
      --ring:0 0 0 3px rgba(212,175,55,.25);
      --shadow:0 20px 45px rgba(0,0,0,.45);
      --shadow-soft:0 10px 25px rgba(0,0,0,.35);
      --border:1px solid rgba(255,255,255,.06);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    }

    /* Page */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Helvetica Neue',Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at -10% -20%, rgba(212,175,55,.10), transparent 60%),
        radial-gradient(900px 500px at 110% 120%, rgba(212,175,55,.10), transparent 60%),
        linear-gradient(135deg, #0a0a0a, #101010 55%, #0c0c0c);
      display:flex; align-items:center; justify-content:center;
      padding:26px;
    }

    /* Layout wrapper */
    .container{
      width:100%;
      max-width:880px;
      display:grid;
      gap:26px;
      grid-template-columns:1fr;
    }
    @media (min-width:900px){
      .container{ grid-template-columns:1fr 1fr; align-items:start; }
    }

    /* Card */
    .card{
      background:linear-gradient(180deg, var(--panel), var(--panel-2));
      border:var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      transform:translateZ(0);
    }
    .cardHeader{
      padding:22px 24px;
      background:
        linear-gradient(180deg, rgba(212,175,55,.12), rgba(212,175,55,.02)),
        linear-gradient(90deg, #1a1a1a, #141414);
      border-bottom:var(--border);
    }
    .cardTitle{
      margin:0;
      font-weight:700;
      letter-spacing:.3px;
      font-size:1.6rem;
      color:var(--gold-2);
      text-shadow:0 0 12px rgba(212,175,55,.18);
    }
    .cardBody{ padding:22px 22px 24px; }

    /* Form controls */
    .field{ margin-bottom:16px; }
    .label{
      display:block; margin:0 0 8px; font-size:.95rem; color:var(--text); font-weight:600;
    }
    .input, .select, .file{
      width:100%;
      background:#0f0f0f;
      color:var(--text);
      border:1px solid rgba(255,255,255,.08);
      border-radius:12px;
      padding:14px 14px;
      outline:none;
      transition:border-color .2s, box-shadow .2s, transform .05s;
      box-shadow:inset 0 1px 0 rgba(255,255,255,.03);
    }
    .input::placeholder{ color:#7e7e7e }
    .input:focus, .select:focus, .file:focus{
      border-color:rgba(212,175,55,.6);
      box-shadow:var(--ring);
    }
    .select{
      appearance:none;
      background-image:
        linear-gradient(45deg, transparent 50%, var(--gold) 50%),
        linear-gradient(135deg, var(--gold) 50%, transparent 50%),
        linear-gradient(to right, rgba(255,255,255,.08), rgba(255,255,255,0));
      background-position:
        calc(100% - 22px) calc(50% - 2px),
        calc(100% - 16px) calc(50% - 2px),
        calc(100% - 42px) 0;
      background-size:6px 6px, 6px 6px, 1px 100%;
      background-repeat:no-repeat;
      padding-right:48px;
    }
    .help{
      font-size:.85rem; color:var(--muted); margin-top:6px;
    }

    /* Account info card */
    .account{
      margin-top:4px;
      padding:14px 16px;
      border-radius:14px;
      border:1px dashed rgba(212,175,55,.45);
      background:linear-gradient(180deg, rgba(212,175,55,.06), rgba(212,175,55,.02));
      box-shadow:var(--shadow-soft);
      display:none;
    }
    .account.show{ display:block; animation:fadeIn .25s ease-out }
    .kv{display:flex; gap:8px; align-items:center; margin:6px 0}
    .k{min-width:165px; color:var(--muted); font-weight:600}
    .v{font-family:var(--mono); letter-spacing:.3px}

    /* Button */
    .btn{
      width:100%;
      border:none;
      border-radius:12px;
      padding:14px 16px;
      font-weight:700;
      color:#1b1b1b;
      background-image:linear-gradient(135deg, #f7e6a5, #d4af37 55%, #b9921a);
      box-shadow:0 10px 22px rgba(212,175,55,.25), inset 0 -2px 0 rgba(0,0,0,.25);
      cursor:pointer;
      transition:transform .08s ease, box-shadow .2s ease, filter .2s ease;
    }
    .btn:active{ transform:translateY(1px) }
    .btn:hover{ filter:saturate(1.05) brightness(1.02) }

    .btnLine{
      width:100%;
      border:1px solid rgba(212,175,55,.5);
      color:var(--gold-2);
      background:transparent;
      padding:12px 14px;
      border-radius:12px;
      font-weight:600;
      cursor:pointer;
      transition:background .2s, color .2s, border-color .2s;
    }
    .btnLine:hover{ background:rgba(212,175,55,.08); border-color:var(--gold-2) }

    /* Receipt values */
    .receiptGrid .kv .k{ min-width:180px }
    .proof{
      margin-top:8px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.08);
      max-height:260px; width:auto;
      display:block;
    }

    .row{ display:flex; gap:12px; }
    .row>.field{ flex:1 }
    @media (max-width:520px){ .row{ flex-direction:column } }

    .hidden{ display:none !important; }

    @keyframes fadeIn{
      from{ opacity:0; transform:translateY(6px) }
      to{ opacity:1; transform:none }
    }

    /* Subtle separators */
    .sep{ height:1px; background:linear-gradient(to right, transparent, rgba(255,255,255,.08), transparent); margin:16px 0 }

    /* Status bar (optional toast) */
    .toast{
      position:fixed; left:50%; bottom:22px; transform:translateX(-50%);
      background:#0f0f0f; color:var(--text); padding:10px 14px; border-radius:10px;
      border:1px solid rgba(255,255,255,.08); box-shadow:var(--shadow-soft);
      font-size:.9rem; display:none;
    }
    .toast.show{ display:block; animation:fadeIn .2s ease-out }
  </style>
</head>

<body>
  <div class="container">

    <!-- FORM -->
    <div id="form-section" class="card">
      <div class="cardHeader"><h2 class="cardTitle">Form Pembayaran</h2></div>
      <div class="cardBody">
        <form id="paymentForm" novalidate>
          <div class="field">
            <label class="label" for="name">Nama Pengirim</label>
            <input id="name" name="name" class="input" type="text" placeholder="Nama lengkap sesuai pengirim" required />
          </div>

          <div class="field">
            <label class="label" for="email">Email</label>
            <input id="email" name="email" class="input" type="email" placeholder="email@domain.com" required />
          </div>

          <div class="row">
            <div class="field">
              <label class="label" for="paymentMethod">Metode Pembayaran</label>
              <select id="paymentMethod" name="paymentMethod" class="select" required>
                <option value="">-- Pilih Metode --</option>
                <option value="Dana">Dana</option>
                <option value="Gopay">Gopay</option>
                <option value="OVO">OVO</option>
                <option value="QRIS">QRIS</option>
              </select>
              <p class="help">Pilih metode yang kamu gunakan untuk transfer.</p>
            </div>

            <div class="field">
              <label class="label" for="amount">Jumlah Pembayaran (Rp)</label>
              <input id="amount" name="amount" class="input" type="number" inputmode="numeric" min="1000" step="100" placeholder="cth. 50000" required />
            </div>
          </div>

          <div id="accountInfo" class="account">
            <div class="kv"><div class="k">No Rekening / E-Wallet</div><div class="v" id="accountNumber">—</div></div>
            <div class="kv"><div class="k">Atas Nama Rekening</div><div class="v" id="accountName">—</div></div>
          </div>

          <div class="sep"></div>

          <div class="field">
            <label class="label" for="proofFile">Upload Bukti Transfer</label>
            <input id="proofFile" class="file" type="file" accept="image/*" required />
            <p class="help">Format gambar (JPG/PNG). Akan dikompresi otomatis untuk pengiriman.</p>
          </div>

          <button type="submit" id="submitBtn" class="btn">
            <span id="btnText">Kirim Pembayaran</span>
          </button>
        </form>
      </div>
    </div>

    <!-- RECEIPT (hidden before send) -->
    <div id="receipt-section" class="card hidden">
      <div class="cardHeader"><h2 class="cardTitle">Struk Pembayaran</h2></div>
      <div class="cardBody receiptGrid">
        <div class="kv"><div class="k">ID Transaksi</div><div class="v" id="receiptTrx"></div></div>
        <div class="kv"><div class="k">Waktu</div><div class="v" id="receiptDate"></div></div>
        <div class="kv"><div class="k">Metode</div><div class="v" id="receiptMethod"></div></div>
        <div class="kv"><div class="k">Atas Nama Rekening</div><div class="v" id="receiptAccountName"></div></div>
        <div class="kv"><div class="k">Nama Pengirim</div><div class="v" id="receiptName"></div></div>
        <div class="kv"><div class="k">Email</div><div class="v" id="receiptEmail"></div></div>
        <div class="kv"><div class="k">Jumlah</div><div class="v">Rp <span id="receiptAmount"></span></div></div>

        <div class="sep"></div>

        <div>
          <div class="label" style="margin-bottom:8px">Bukti Transfer</div>
          <img id="receiptProof" class="proof" alt="Bukti transfer">
        </div>

        <div class="sep"></div>

        <button id="downloadPDF" class="btnLine">Download PDF</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    // ====== EmailJS Keys (GANTI DENGAN PUNYAMU) ======
    const PUBLIC_KEY  = "832fKv_GgI-apbZdD";
    const SERVICE_ID  = "service_rxj53np";
    const TEMPLATE_ID = "template_cut73vo";
    
    emailjs.init(PUBLIC_KEY);

    // ====== Elements ======
    const paymentForm = document.getElementById("paymentForm");
    const formSection = document.getElementById("form-section");
    const receiptSection = document.getElementById("receipt-section");
    const btnText = document.getElementById("btnText");

    const paymentMethod = document.getElementById("paymentMethod");
    const accountInfo = document.getElementById("accountInfo");
    const accountNumber = document.getElementById("accountNumber");
    const accountName = document.getElementById("accountName");

    const receiptTrx = document.getElementById("receiptTrx");
    const receiptDate = document.getElementById("receiptDate");
    const receiptMethod = document.getElementById("receiptMethod");
    const receiptAccountName = document.getElementById("receiptAccountName");
    const receiptName = document.getElementById("receiptName");
    const receiptEmail = document.getElementById("receiptEmail");
    const receiptAmount = document.getElementById("receiptAmount");
    const receiptProof = document.getElementById("receiptProof");

    // ====== Data Rekening per Metode (ubah sesuai data kamu) ======
    const paymentData = {
      "Dana":  { number: "0812-3456-7890", name: "PT Contoh Dana" },
      "Gopay": { number: "0812-3456-7891", name: "PT Contoh Gopay" },
      "OVO":   { number: "0812-3456-7892", name: "PT Contoh OVO" },
      "QRIS":  { number: "QRIS-1234567890", name: "PT Contoh QRIS" }
    };

    paymentMethod.addEventListener("change", () => {
      const selected = paymentMethod.value;
      if (paymentData[selected]) {
        accountNumber.textContent = paymentData[selected].number;
        accountName.textContent = paymentData[selected].name;
        accountInfo.classList.add("show");
      } else {
        accountInfo.classList.remove("show");
      }
    });

    // ====== Image compression ======
    let proofBase64 = "";
    document.getElementById("proofFile").addEventListener("change", function () {
      const file = this.files[0];
      if (!file) return;
      compressImage(file, 900, 0.75, (b64) => { proofBase64 = b64; });
    });

    function compressImage(file, maxSize = 900, quality = 0.75, cb){
      const reader = new FileReader();
      reader.onload = e => {
        const img = new Image();
        img.onload = () => {
          let { width, height } = img;
          if (width > height && width > maxSize){ height *= maxSize / width; width = maxSize; }
          else if (height > width && height > maxSize){ width *= maxSize / height; height = maxSize; }
          const canvas = document.createElement("canvas");
          canvas.width = width; canvas.height = height;
          const ctx = canvas.getContext("2d");
          ctx.drawImage(img, 0, 0, width, height);
          cb(canvas.toDataURL("image/jpeg", quality));
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    // ====== Helpers ======
    function generateTrxId(){
      return "TRX-" + Date.now().toString(36).toUpperCase() + "-" + Math.floor(Math.random()*899+100);
    }
    function toast(msg){
      const el = document.getElementById("toast");
      el.textContent = msg; el.classList.add("show");
      setTimeout(()=> el.classList.remove("show"), 2000);
    }

    // ====== Submit handler ======
    paymentForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim();
      const method = paymentMethod.value;
      const amount = document.getElementById("amount").value.trim();

      if (!method){ toast("Pilih metode pembayaran."); return; }
      if (!proofBase64){ toast("Unggah bukti transfer lebih dulu."); return; }

      const date = new Date().toLocaleString();
      const trxId = generateTrxId();
      const accName = accountName.textContent || "-";

      btnText.textContent = "Mengirim…";

      const params = {
        user_name: name,
        user_email: email,
        amount: amount,
        payment_method: method,
        trx_id: trxId,
        proof: proofBase64
      };

      try{
        await emailjs.send(SERVICE_ID, TEMPLATE_ID, params);

        // Fill receipt
        receiptTrx.textContent = trxId;
        receiptDate.textContent = date;
        receiptMethod.textContent = method;
        receiptAccountName.textContent = accName;
        receiptName.textContent = name;
        receiptEmail.textContent = email;
        receiptAmount.textContent = Number(amount).toLocaleString("id-ID");
        receiptProof.src = proofBase64;

        // Show receipt after success
        receiptSection.classList.remove("hidden");
        toast("Pembayaran terkirim.");

      }catch(err){
        console.error("EmailJS error:", err);
        alert("Gagal mengirim pembayaran. Coba lagi.");
      }finally{
        btnText.textContent = "Kirim Pembayaran";
      }
    });

    // ====== Download PDF ======
    document.getElementById("downloadPDF").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFont("helvetica","bold");
      doc.setFontSize(18);
      doc.text("Struk Pembayaran", 20, 18);

      doc.setFont("helvetica","normal");
      doc.setFontSize(12);
      let y = 34;
      const L = 20;

      const rows = [
        ["ID Transaksi", document.getElementById("receiptTrx").innerText],
        ["Waktu", document.getElementById("receiptDate").innerText],
        ["Metode", document.getElementById("receiptMethod").innerText],
        ["Atas Nama Rekening", document.getElementById("receiptAccountName").innerText],
        ["Nama Pengirim", document.getElementById("receiptName").innerText],
        ["Email", document.getElementById("receiptEmail").innerText],
        ["Jumlah", "Rp " + document.getElementById("receiptAmount").innerText]
      ];

      rows.forEach(([k,v])=>{
        doc.text(`${k}:`, L, y);
        doc.text(String(v), L+58, y);
        y += 8;
      });

      // Proof image
      try{ doc.addImage(proofBase64, "JPEG", L, y+4, 120, 90); }catch(_){}
      doc.save("Struk_Pembayaran.pdf");
    });
  </script>
</body>
  </html>
